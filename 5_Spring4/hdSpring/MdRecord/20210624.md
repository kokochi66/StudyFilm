<h1> 20210624 스프링 실습 프로젝트 공부내용 </h1>
<h2>16장 : 예외처리 </h2>
<img src="https://user-images.githubusercontent.com/61536109/123201736-3f0c2e80-d4ee-11eb-917b-880e13687ac8.png" height="150px"/>
<p>
	웹 컨테이너는 예외처리를 하여 기본 에러 페이지를 표시해준다. 이런 페이지는 어플리케이션 서버의 내부 정보가 일반 사용자들에게 노출되어 프레임워크 보안 취약점을 노린 공격을 받을 수 있기 때문에, <strong>사용자가 최대한 직접 예외처리를 하여 에러 페이지를 표시</strong>하게 해야한다.
</p> <br><br>
<h3> 상태 코드를 사용한 에러 페이지 설정 </h3>
<p>
	웹 컨테이너 설정 파일(web.xml) 에 <strong>상태 코드</strong>를 설정하고, 이동 대상 페이지를 지정하는 방법을 사용할 수 있다.
</p>
<pre>
&lt;error-page&gt;
	&lt;err-code&gt;400&lt;/err-code&gt;
	&lt;location&gt;/WEB-INF/views/error/errorCommon.jsp&lt;/location&gt;
&lt;/error-page&gt;
&lt;error-page&gt;
	&lt;err-code&gt;404&lt;/err-code&gt;
	&lt;location&gt;/WEB-INF/views/error/errorCommon.jsp&lt;/location&gt;
&lt;/error-page&gt;
&lt;error-page&gt;
	&lt;err-code&gt;500&lt;/err-code&gt;
	&lt;location&gt;/WEB-INF/views/error/errorCommon.jsp&lt;/location&gt;
&lt;/error-page&gt;
</pre>
<p> web.xml </p> <br><br>
<h3> 예외 타입을 사용한 에러 페이지 설정 </h3>
<p> 웹 컨테이너 설정 파일(web.xml)에 <strong>예외 타입</strong>을 설정하고 이동 대상 페이지를 지정한다.</p>
<pre>
&lt;error-page&gt;
	&lt;exception-type&gt;java.lang.Exception&lt;/exception-type&gt;
	&lt;location&gt;/WEB-INF/views/error/errorCommon.jsp&lt;/location&gt;
&lt;/error-page&gt;
</pre>
<p> web.xml </p> <br><br>
<h3> 기본 에러 페이지 설정 </h3>
<p> 웹 컨테이너 설정 파일(web.xml)에 location 요소만 지정하여 기본 에러 페이지를 설정할 수 있다.</p>
<pre>
&lt;error-page&gt;
	&lt;location&gt;/WEB-INF/views/error/errorCommon.jsp&lt;/location&gt;
&lt;/error-page&gt;
</pre>
<p> web.xml </p> <br><br>
<h3> 예외처리 어노테이션 </h3>
<p> @ControllerAdvice와 @ExceptionHandler를 이용해서 예외를 처리한다. 여기서 @ConstrollerAdvice는 스프링 컨트롤러에서 예외 처리하는 핸들러 클래스임을 명시하고, @ExceptionHandler는 괄호안에 설정한 예외 타입을 해당 메서드가 처리하도록 한다. 여기서 클래스를 정의하려면 context에서 읽을 수 있어야하기 때문에 scan설정을 해주어야한다.</p>
<pre>
<strong>@ControllerAdvice</strong>
public class CommonExceptionHandler {
	private static Logger logger = LoggerFactory.getLogger(CommonExceptionHandler.class);
	<strong>@ExceptionHandler(Exception.class)</strong>
	public String handle(Exception e) {
		return "error/errorCommon";
	}
}
</pre>
<p> CommonExceptionHandler.java </p> <br><br>
<h3> 예외정보를 뷰에 출력 </h3>
<p> 예외 내용을 Model 객체를 이용하여 뷰 화면에서 출력할 수 있다.</p>
<pre>
@ExceptionHandler(Exception.class)
public String handle(Exception ex, Model model) {
	<strong>model.addAttribute("exception", ex);</strong>
	return "/error/errorCommon2";
}
</pre>
<p> CommonExceptionHandler.java </p>
<pre>
&lt;h4&gt;${exception.getMessage()}&lt;/h4&gt;
&lt;ul&gt;
	&lt;c:forEach items=&quot;${exception.getStackTrace()}&quot; var=&quot;stack&quot;&gt;
		&lt;li&gt; ${stack.toString()} &lt;/li&gt;
	&lt;/c:forEach&gt;
&lt;/ul&gt;
</pre>
<p> errorCommon2.jsp </p> <br><br>
<h3> 404 에러페이지 처리 </h3>
<p> 404 에러를 처리할 수 있도록 DispatcherServlet에 throwExceptionIfNoHandlerFound 속성을 true로 설정하고, 해당 에러를 처리하도록 코드를 구성한다.</p>
<pre>
&lt;servlet&gt;
	&lt;servlet-name&gt;appServlet&lt;/servlet-name&gt;
	&lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
	&lt;init-param&gt;
		&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
		&lt;param-value&gt;/WEB-INF/spring/appServlet/servlet-context.xml&lt;/param-value&gt;
	&lt;/init-param&gt;
	&lt;!-- 404에러를 처리하도록 throwExceptionIfNoHandlerFound를 true로 설정한다. --&gt;
	<strong>&lt;init-param&gt;
		&lt;param-name&gt;throwExceptionIfNoHandlerFound&lt;/param-name&gt;
		&lt;param-value&gt;true&lt;/param-value&gt;
	&lt;/init-param&gt;</strong>
	&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
</pre>
<p> web.xml (DispatcherServlet 선언부분 내부에 굵기처리 된 코드를 넣는다.) </p>
<pre>
@ExceptionHandler(NoHandlerFoundException.class)
@ResponseStatus(HttpStatus.NOT_FOUND)
public String handle404(Exception e) {
	return "error/error404";
}
</pre>
<p> CommonExceptionHandler.java </p> <br><br>
<h3> 입력값 검증 예외 처리 </h3>
<p> @Valideted 어노테이션을 이용하여, 유효성 검증 메커니즘을 사용할 수 있다. 여기서 BindingResult에 요청 데이터의 바인딩 에러와 검사 에러 정보가 저장되어 에러 확인 시, 조건문을 이용해서 별도의 처리를 메소드 내에 적용할 수 있다. </p>
<pre>
@RequestMapping(value="/register", method=RequestMethod.POST)
public String register(<strong>@Validated Board board, BindingResult result</strong>, Model model) throws Exception {
	if(result.hasErrors()) return"board/register";
	service.register(board);
	model.addAttribute("msg", "등록이 완료되었습니다.");
	return "board/success";
}
</pre>
<p> BoardController.java </p> <br><br>
